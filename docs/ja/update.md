# アップデート
Exmentのバージョンが更新され、アップデートが必要になった場合の手順です。  
更新履歴は[こちら](/ja/release_note)をご確認ください。

- v3.X.X以下から、v4.0.Xへのアップデートは、手動でのアップデートが必要です。[こちら](/ja/update/v4_0)の内容を一度ご確認の上、更新を行ってください。

- v4.3.X以下から、v4.4.X以上へのアップデートは、手動でのアップデートが必要です。[こちら](/ja/update/v4_4)の内容を一度ご確認の上、更新を行ってください。 

- <span class="red bold">v4.4.X以下から、v5.0.0以上へのアップデートは、手動でのアップデートが必要です。[こちら](/ja/update/v5_0_php8)の内容を一度ご確認の上、更新を行ってください。</span>

- アップデート時にエラーが発生した場合、[トラブルシューティング](/ja/troubleshooting)をご参照ください。


## アップデート方法
Exmentでは現在、いくつかのアップデート方法をご提供しています。

- ##### アップデートバッチからアップデート(推奨)
→アップデートを実施する場合、サーバーにログインし、バッチ実行により、アップデートを実施します。

- ##### 自動アップデート
→cron実行によるアップデートを実施できます。アップデートの有無を毎日チェックし、自動的にアップデートできます。  
詳細は[こちら](/ja/update_auto)をご確認ください。

- ##### 手動アップデート  
→手動でコマンドからアップデートを実行する場合です。

- ##### 開発版・過去バージョンを導入する、一時的にソースコードを入れ替える  
→開発版を導入する、過去バージョンを導入する、一時的にソースコードを入れ替える、といった作業を実施する場合、[こちら](/ja/update_tmp)をご確認ください。  


## アップデートバッチからアップデート
<span class="red bold">※2021/04/13、アップデートバッチを更新しました。最新版のダウンロード・差し替えをお願いします。</span>

### (初回のみ)アップデートバッチのダウンロード

#### Windowsの場合
- 以下のファイルをダウンロードします。  
[ExmentUpdateWindows.bat](https://exment.net/downloads/cmd/ExmentUpdateWindows.bat)

- ダウンロードしたファイルを、プロジェクトのルートディレクトリに配置してください。

#### さくらインターネットの場合
- 以下のコマンドを、プロジェクトのルートディレクトリで実行し、ダウンロードを行ってください。

~~~
wget https://exment.net/downloads/cmd/ExmentUpdateLinuxSakura.sh
chmod 775 ExmentUpdateLinuxSakura.sh
~~~

#### Xserverの場合
- 以下のコマンドを、プロジェクトのルートディレクトリで実行し、ダウンロードを行ってください。

~~~
wget https://exment.net/downloads/cmd/ExmentUpdateLinuxXserver.sh
chmod 775 ExmentUpdateLinuxXserver.sh
~~~

#### Linuxの場合
- 以下のコマンドを、プロジェクトのルートディレクトリで実行し、ダウンロードを行ってください。

~~~
wget https://exment.net/downloads/cmd/ExmentUpdateLinux.sh
chmod 775 ExmentUpdateLinux.sh
~~~


#### Macの場合
- 以下のファイルをダウンロードします。  
https://exment.net/downloads/cmd/ExmentUpdateLinux.sh

- ダウンロードしたファイルを、プロジェクトのルートディレクトリに配置してください。

- 以下のコマンドを実行してください。

~~~
chmod 775 ExmentUpdateLinux.sh
~~~

### アップデートバッチの実行
アップデートバッチを実行してください。

#### Linux・Macの場合
- 以下のコマンドを、プロジェクトのルートディレクトリで実行してください。

~~~
sh ExmentUpdateLinux.sh
# さくらインターネットの場合
# sh ExmentUpdateLinuxSakura.sh
# Xserverの場合
# sh ExmentUpdateLinuxXserver.sh
~~~

#### Windowsの場合
- 以下のバッチファイルを実行してください。  

~~~
ExmentUpdateWindows.bat
~~~

### アップデートバッチの実行内容
アップデートバッチでは、以下の内容を実行しています。  
 - データのバックアップ
 - 最新ソース取得、反映
 - データベース更新


## 手動によるアップデート方法
手動でコマンドからアップデートを実行する場合、こちらを実施してください。

### (推奨)データのバックアップ
データのバックアップを実行します。詳細は[バックアップ](/ja/backup)をご確認ください。  
- 管理者でExmentにログインし、左メニューより「管理者設定」→「バックアップ」を選択します。
- 「バックアップ」ページ右上の［バックアップ］ボタンをクリックします。
- 最新のデータ、ならびに添付ファイルなどのバックアップが作成されます。
- その後、実行した時刻のバックアップファイルをクリックし、ダウンロードします。


### 最新ソース取得、反映、データベース更新

- 現在、XServerではPHPのSodium拡張をデフォルトでインストールすることはサポートされていません。  
※もし本当にインストールが必要な場合は、XServerのサポートチームに連絡する必要があります。  

- XServerでComposerをアップデートしたい場合、通常のアップデートコマンドとは異なるコマンドを使用する必要があります。  
通常: `composer update` <span style="color: red;">✖</span>  
実際: `composer update --ignore-platform-reqs`  
→ このコマンドはSodiumのチェックを無視し、Composerのアップデートを直接実行します。  

- コマンドラインで、以下のコマンドを実行します。  
※リリース直後だと、最新バージョンが検知されない場合があります。その場合、10～20分ほど経過後、再度下記コマンドを実行してください。  

~~~
cd (プロジェクトのルートディレクトリ)
composer update --ignore-platform-reqs` 
php artisan exment:update
~~~