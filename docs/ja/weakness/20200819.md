# 脆弱性対応 クロスサイトスクリプティング、ならびに画面入力でのスクリプト実行の方針について

## 概要

### 情報公開日
2020/08/19

### 対象バージョン
v3.6.0未満

## 脆弱性内容
Exmentの画面入力項目によって、クロスサイトスクリプティングが発生する。

### 発覚経緯
届出により発覚。

### 発生条件
以下の項目で、スクリプトを入力した場合に、スクリプトが実行される。  

- システム管理者が、メニュー「メールテンプレート」の本文にスクリプトを入力し、ページ右上の通知アイコンより、通知詳細を表示した場合。
- システム管理者が、カスタムフォーム設定の項目「説明文」にスクリプトを入力した場合。
- カスタム列の種類「エディター」で、スクリプトを入力した場合。


### 脆弱性がもたらす脅威
被害者のセッションにおいて、再認証を伴わない機能を悪用される。また、ページの見かけ上の改ざんによるフィッシングなどに悪用される。


### 対応方法
v3.6.0にバージョンアップを行ってください。


## 画面入力でのスクリプト実行の方針について
**Exmentでは、一部の入力項目で、意図的にHTML・スクリプトを入力可能にしている箇所があります。**  
以下、HTML・スクリプトを入力可能にしている箇所についての方針について、記載します。


#### 管理者により、HTML・スクリプトを入力可能にしている項目
- 管理者のみ入力可能な項目ですので、HTMLを入力可能としております。  
- また、スクリプトを実行したいケースを考慮し、スクリプトも実行可能にしております。

##### 該当箇所
- ダッシュボード項目の、「システム」→表示アイテム「HTML」
- カスタムフォーム設定の、フォーム項目「HTML」「拡張HTML」  
※v3.6.0より、スクリプトを入力可能であることを画面で明記いたしました。


#### 一部のHTMLを入力可能とし、対象外のHTMLならびにスクリプトは入力不可能な項目
- デザインを含めたテキストを入力可能としておりますので、HTMLを使用して値を保存し、HTML形式で画面に表示します。   
- ただしv3.6.0より、利用できるHTMLには一部制限をかけております。
- また、対象外のHTML、許可されていない属性、スクリプトを入力した場合は、該当のスクリプトは自動的にエスケープして表示されます。  
- 対象外のHTML、許可されていない属性、スクリプトの除去は、[HTML Purifier](https://github.com/mewebstudio/Purifier)を使用します。

##### 該当箇所
- カスタム列「エディター」のデータ編集画面
- メールテンプレートのテンプレート設定画面。※通知一覧画面から通知の詳細を表示した場合が該当

##### 入力可能なHTMLタグ(v3.6.0より)
- []で囲まれているタグは、利用可能な属性です。
- また、すべてのタグで、style属性を使用可能です。

```
div,b,strong,i,em,u,a[href|title|target],ul,ol,li,p,br,span,img[width|height|alt|src],h1,h2,h3,h4,h5,h6,blockquote,hr
```

#### それ以外の項目
- HTMLならびにスクリプトを入力した場合、自動的にエスケープして表示されます。


### 謝辞
この度ご報告いただきました。三井物産セキュアディレクション株式会社　小山様、情報処理推進機構 IPA様、JPCERT/CC 脆弱性ハンドリングチーム様には、この場を借りてお礼申し上げます。

  
[←一覧へ戻る](/ja/patch_weakness)